var ModalView=Backbone.View.extend({name:"ModalView",modalBlanket:null,modalContainer:null,defaultOptions:{fadeInDuration:150,fadeOutDuration:150,showCloseButton:!0,bodyOverflowHidden:!1,setFocusOnFirstFormControl:!0,targetContainer:document.body,slideFromAbove:!1,slideFromBelow:!1,slideDistance:150,closeImageUrl:"close-modal.png",closeImageHoverUrl:"close-modal-hover.png",css:{}},initialize:function(){},events:{},showModalBlanket:function(){return this.ensureModalBlanket().fadeIn(this.options.fadeInDuration)},
hideModalBlanket:function(){return this.modalBlanket.fadeOut(this.options.fadeOutDuration)},ensureModalContainer:function(a){null!=a&&null!=this.modalContainer&&(this.modalContainer.remove(),this.modalContainer=null);null==this.modalContainer&&(this.modalContainer=$("<div id='modalContainer'>").css({"z-index":"99",position:"relative","-webkit-border-radius":"6px","-moz-border-radius":"6px","border-radius":"6px"}).appendTo(a));return this.modalContainer},ensureModalBlanket:function(){this.modalBlanket=
$("#modal-blanket");0==this.modalBlanket.length&&(this.modalBlanket=$("<div id='modal-blanket'>").css({position:"absolute",top:$(document).scrollTop(),left:0,height:$(document).height(),width:"100%",opacity:0.5,backgroundColor:"#000","z-index":90}).appendTo(document.body).hide());return this.modalBlanket},keyup:function(a){27==a.keyCode&&this.hideModal()},click:function(a){"modal-blanket"==a.target.id&&this.hideModal()},setFocusOnFirstFormControl:function(){var a=$("input, select, email, url, number, range, date, month, week, time, datetime, datetime-local, search, color",
$(this.el));0<a.length&&$(a[0]).focus()},hideModal:function(){this.trigger("closeModalWindow");this.hideModalBlanket();$(document.body).unbind("keyup",this.keyup);$(document.body).unbind("click",this.click);!0===this.options.bodyOverflowHidden&&$(document.body).css("overflow",this.originalBodyOverflowValue);var a=this.modalContainer;$(this.modalContainer).fadeOut(this.options.fadeOutDuration,function(){a.remove()})},getCoordinate:function(a,b){if("undefined"!==typeof b[a]){var d=b[a];delete b[a];
return d}},showModal:function(a){this.defaultOptions.targetContainer=document.body;this.options=$.extend(!0,{},this.defaultOptions,a);var b=$(this.el),d=$(window).height()/2,e=$(window).width()/2,a=this.ensureModalContainer(this.options.targetContainer).empty();b.addClass("modal");var c={top:this.getCoordinate("top",this.options.css),left:this.getCoordinate("left",this.options.css),right:this.getCoordinate("right",this.options.css),bottom:this.getCoordinate("bottom",this.options.css),isEmpty:function(){return null==
this.top&&null==this.left&&null==this.right&&null==this.bottom}};b.css(this.options.css);this.showModalBlanket();this.keyup=_.bind(this.keyup,this);this.click=_.bind(this.click,this);$(document.body).keyup(this.keyup);$(document.body).click(this.click);!0===this.options.bodyOverflowHidden&&(this.originalBodyOverflowValue=$(document.body).css("overflow"),$(document.body).css("overflow","hidden"));a.append(b);a.css({opacity:0,position:"absolute","z-index":99});c.isEmpty()?(d-=b.outerHeight()/2,"undefined"!==
typeof this.options.y&&(d=this.options.y),a.css({top:d+"px"}),b=e-b.outerWidth()/2,"undefined"!==typeof this.options.x&&(b=this.options.x),a.css({left:b+"px"})):(null!=c.top&&a.css({top:c.top}),null!=c.left&&a.css({left:c.left}),null!=c.right&&a.css({right:c.right}),null!=c.bottom&&a.css({bottom:c.bottom}));this.options.setFocusOnFirstFormControl&&this.setFocusOnFirstFormControl();if(this.options.showCloseButton){var f=this;$("<a href='#' id='modalCloseButton'>&#160;</a>").css({}).appendTo(this.modalContainer).click(function(a){a.preventDefault();
f.hideModal()})}b={opacity:1};e=a.offset();this.options.slideFromAbove&&(a.css({top:e.top-this.options.slideDistance+"px"}),b.top=c.top);this.options.slideFromBelow&&(a.css({top:e.top+this.options.slideDistance+"px"}),b.top=c.top);this.modalContainer.animate(b,this.options.fadeInDuration)}});
